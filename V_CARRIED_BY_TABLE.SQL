create view V_CARRIED_BY_TABLE as 

SELECT        
    br_id.BATCH_RUN_ID, 
    br_id.STEP_ID, 
    CV.MODIFIED_DATE_TIME, 
    P.USER_NAME, 
    P.FIRST_NAME, 
    P.LAST_NAME
FROM            
    UEIOS_V3.dbo.BATCH_RUN BR
    INNER JOIN UEIOS_V3.dbo.BATCH_RUN_STEP BRS ON BRS.BATCH_RUN_ID = BR.ID AND ISNULL(BRS.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_INTERNAL_V3.dbo.CHECKLIST_RELATIONSHIPS CR ON CR.BATCH_RUN_STEP_ID = BRS.ID AND ISNULL(CR.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING CCM ON CCM.ID = CR.CHECKLIST_MAPPING_ID AND ISNULL(CCM.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST CH ON CH.ID = CCM.CHECKLIST_LINK_ID AND ISNULL(CH.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_TEMPLATE CT ON CT.ID = CH.CHECKLIST_TEMPLATE_LINK_ID AND ISNULL(CT.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_CATEGORY CCAT ON CCAT.ID = CT.CHECKLIST_CATEGORY_LINK_ID AND ISNULL(CCAT.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_GROUP CG ON CG.CHECKLIST_TEMPLATE_LINK_ID = CT.ID AND ISNULL(CG.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING_GROUP CMG ON CMG.CHECKLIST_MAPPING_LINK_ID = CCM.ID AND CMG.CHECKLIST_GROUP_LINK_ID = CG.ID AND ISNULL(CMG.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_ITEM CI ON CI.CHECKLIST_GROUP_LINK_ID = CG.ID AND ISNULL(CI.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING_ITEM CMI ON CMI.CHECKLIST_ITEM_LINK_ID = CI.ID AND CMI.CHECKLIST_MAPPING_GROUP_LINK_ID = CMG.ID AND ISNULL(CMI.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_COLUMN CC ON CC.CHECKLIST_TEMPLATE_LINK_ID = CT.ID AND ISNULL(CC.IS_DELETED, 0) = 0
    LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_VALUE CV ON CV.CHECKLIST_COLUMN_LINK_ID = CC.ID AND CV.CHECKLIST_ITEM_LINK_ID = CI.ID AND CV.CHECKLIST_MAPPING_ITEM_LINK_ID = CMI.ID AND ISNULL(CV.IS_DELETED, 0) = 0
    INNER JOIN (
        SELECT        
            BRS.BATCH_RUN_ID, 
            MAX(CV.ID) AS checklist_value_id, 
            BRS.ID AS STEP_ID
        FROM            
            UEIOS_V3.dbo.BATCH_RUN_STEP BRS
            LEFT OUTER JOIN UEIOS_INTERNAL_V3.dbo.CHECKLIST_RELATIONSHIPS CR ON CR.BATCH_RUN_STEP_ID = BRS.ID AND ISNULL(CR.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING CCM ON CCM.ID = CR.CHECKLIST_MAPPING_ID AND ISNULL(CCM.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST CH ON CH.ID = CCM.CHECKLIST_LINK_ID AND ISNULL(CH.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_TEMPLATE CT ON CT.ID = CH.CHECKLIST_TEMPLATE_LINK_ID AND ISNULL(CT.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_GROUP CG ON CG.CHECKLIST_TEMPLATE_LINK_ID = CT.ID AND ISNULL(CG.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING_GROUP CMG ON CMG.CHECKLIST_MAPPING_LINK_ID = CCM.ID AND CMG.CHECKLIST_GROUP_LINK_ID = CG.ID AND ISNULL(CMG.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_ITEM CI ON CI.CHECKLIST_GROUP_LINK_ID = CG.ID AND ISNULL(CI.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_MAPPING_ITEM CMI ON CMI.CHECKLIST_ITEM_LINK_ID = CI.ID AND CMI.CHECKLIST_MAPPING_GROUP_LINK_ID = CMG.ID AND ISNULL(CMI.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_COLUMN CC ON CC.CHECKLIST_TEMPLATE_LINK_ID = CT.ID AND ISNULL(CC.IS_DELETED, 0) = 0
            LEFT OUTER JOIN UEIOS_V4.dbo.CHK_CHECKLIST_VALUE CV ON CV.CHECKLIST_COLUMN_LINK_ID = CC.ID AND CV.CHECKLIST_ITEM_LINK_ID = CI.ID AND CV.CHECKLIST_MAPPING_ITEM_LINK_ID = CMI.ID AND ISNULL(CV.IS_DELETED, 0) = 0
        WHERE        
            ISNULL(BRS.NOTES, '') != 'MIB_CHECKLIST'
            AND ISNULL(BRS.IS_DELETED, 0) = 0
        GROUP BY 
            BRS.BATCH_RUN_ID, BRS.ID
    ) AS br_id ON CV.ID = br_id.checklist_value_id
    INNER JOIN UEIOS_V3.dbo.PERSONNEL P ON CV.CREATED_BY_USERNAME = P.USER_NAME
WHERE        
    ISNULL(CV.IS_DELETED, 0) = 0 
    AND ISNULL(P.IS_DELETED, 0) = 0;
